<!DOCTYPE html>
<html lang="en"><head>
<script src="numalgintro_files/libs/clipboard/clipboard.min.js"></script>
<script src="numalgintro_files/libs/quarto-html/tabby.min.js"></script>
<script src="numalgintro_files/libs/quarto-html/popper.min.js"></script>
<script src="numalgintro_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="numalgintro_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="numalgintro_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="numalgintro_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="numalgintro_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Joong-Ho Won">
  <title>Numerical Linear Algebra</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="numalgintro_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="numalgintro_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="numalgintro_files/libs/revealjs/dist/theme/quarto.css">
  <link href="numalgintro_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="numalgintro_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="numalgintro_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="numalgintro_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Numerical Linear Algebra</h1>
  <p class="subtitle">Advanced Statistical Computing</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Joong-Ho Won 
</div>
        <p class="quarto-title-affiliation">
            Seoul National University
          </p>
    </div>
</div>

  <p class="date">October 2023</p>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">versioninfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Julia Version 1.9.3
Commit bed2cd540a1 (2023-08-24 14:43 UTC)
Build Info:
  Official https://julialang.org/ release
Platform Info:
  OS: macOS (x86_64-apple-darwin22.4.0)
  CPU: 8 × Intel(R) Core(TM) i5-8279U CPU @ 2.40GHz
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-14.0.6 (ORCJIT, skylake)
  Threads: 2 on 8 virtual cores</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="fu">pwd</span>())</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="bu">Pkg</span>.<span class="fu">instantiate</span>()</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="bu">Pkg</span>.<span class="fu">status</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status `~/Dropbox/class/M1399.000200/2023/M1300_000200-2023fall/lectures/05-numalgintro/Project.toml`
  [6e4b80f9] BenchmarkTools v1.3.2
  [6f49c342] RCall v0.13.18</code></pre>
</div>
</div>
</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<ul>
<li>Topics in numerical linear algebra:
<ul>
<li>BLAS<br>
</li>
<li>solve linear equations <span class="math inline">\(\mathbf{A} \mathbf{x} = \mathbf{b}\)</span></li>
<li>regression computations <span class="math inline">\(\mathbf{X}^T \mathbf{X} \beta = \mathbf{X}^T \mathbf{y}\)</span><br>
</li>
<li>eigen-problems <span class="math inline">\(\mathbf{A} \mathbf{x} = \lambda \mathbf{x}\)</span><br>
</li>
<li>generalized eigen-problems <span class="math inline">\(\mathbf{A} \mathbf{x} = \lambda \mathbf{B} \mathbf{x}\)</span><br>
</li>
<li>singular value decompositions <span class="math inline">\(\mathbf{A} = \mathbf{U} \Sigma \mathbf{V}^T\)</span><br>
</li>
<li>iterative methods for numerical linear algebra</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Except for the iterative methods, most of these numerical linear algebra tasks are implemented in the BLAS and LAPACK libraries. They form the <strong>building blocks</strong> of most statistical computing tasks (optimization, MCMC).</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Our major <strong>goal</strong> (or learning objectives) is to
<ol type="1">
<li>know the complexity (flop count) of each task</li>
<li>be familiar with the BLAS and LAPACK functions (what they do)<br>
</li>
<li>do <strong>not</strong> re-invent the wheel by implementing these dense linear algebra subroutines by yourself<br>
</li>
<li>understand the need for iterative methods<br>
</li>
<li>apply appropriate numerical algebra tools to various statistical problems</li>
</ol></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>All high-level languages (R, Matlab, Julia) call BLAS and LAPACK for numerical linear algebra.
<ul>
<li>Julia offers more flexibility by exposing interfaces to many BLAS/LAPACK subroutines directly. See <a href="https://docs.julialang.org/en/v1/stdlib/LinearAlgebra/#BLAS-functions">documentation</a>.</li>
</ul></li>
</ul>
</section>
<section id="blas" class="slide level2">
<h2>BLAS</h2>
<ul>
<li><p>BLAS stands for <em>basic linear algebra subroutines</em>.</p></li>
<li><p>See <a href="http://www.netlib.org/blas/">netlib</a> for a complete list of standardized BLAS functions.</p></li>
<li><p>There are many implementations of BLAS.</p>
<ul>
<li><a href="http://www.netlib.org/blas/">Netlib</a> provides a reference implementation.<br>
</li>
<li>Julia uses <a href="http://www.openblas.net">OpenBLAS</a>, a fast, actively maintained fork of <a href="https://www.tacc.utexas.edu/research-development/tacc-software/gotoblas2">GotoBLAS</a>, which has an <a href="https://www.nytimes.com/2005/11/28/technology/writing-the-fastest-code-by-hand-for-fun-a-human-computer-keeps.html">interesting history</a>.</li>
<li>Julia can switch to Intel’s <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html">oneAPI Math Kernel Library (oneMKL)</a> at runtime by using <a href="https://github.com/JuliaLinearAlgebra/MKL.jl">MKL.jl</a>.
<ul>
<li><strong>MKL is the gold standard on the market.</strong> It is not open source but the compiled library is free for Linux/macOS.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="openblas-vs-mkl">OpenBLAS vs MKL</h3>
<div class="cell" data-tags="[]" data-execution_count="38">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>, <span class="bu">BenchmarkTools</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>BLAS.<span class="fu">get_config</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>LinearAlgebra.BLAS.LBTConfig
Libraries: 
└ [ILP64] libopenblas64_.0.3.21.dylib</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1"></a>numthreads <span class="op">=</span> BLAS.<span class="fu">get_num_threads</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>4</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="40">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1"></a>BLAS.<span class="fu">set_num_threads</span>(<span class="fl">1</span>)   <span class="co"># for fair comparison with MKL</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>A <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">1000</span>,<span class="fl">1000</span>); B <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">1000</span>,<span class="fl">1000</span>);</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="pp">@btime</span> <span class="op">$</span>A <span class="op">*</span> <span class="op">$</span>B;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  36.960 ms (2 allocations: 7.63 MiB)</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="41">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1"></a><span class="pp">@btime</span> <span class="fu">inv</span>(<span class="op">$</span>A);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  56.397 ms (5 allocations: 8.13 MiB)</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-tags="[]" data-execution_count="42">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1"></a><span class="im">using</span> <span class="bu">MKL</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>BLAS.<span class="fu">get_config</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>LinearAlgebra.BLAS.LBTConfig
Libraries: 
├ [ILP64] libmkl_rt.2.dylib└ [ LP64] libmkl_rt.2.dylib</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1"></a>BLAS.<span class="fu">set_num_threads</span>(<span class="fl">1</span>)  <span class="co"># multithreading is disabled on mac in MKL.jl</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="pp">@btime</span> <span class="op">$</span>A <span class="op">*</span> <span class="op">$</span>B;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  35.917 ms (2 allocations: 7.63 MiB)</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1"></a><span class="pp">@btime</span> <span class="fu">inv</span>(<span class="op">$</span>A);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  46.220 ms (5 allocations: 9.35 MiB)</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1"></a><span class="bu">LinearAlgebra</span>.<span class="fu">__init__</span>()   <span class="co"># back to OpenBLAS. MKL.__init__() to switch to MKL back.</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>BLAS.<span class="fu">get_config</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>LinearAlgebra.BLAS.LBTConfig
Libraries: 
└ [ILP64] libopenblas64_.0.3.21.dylib</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1"></a>BLAS.<span class="fu">get_num_threads</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>4</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>There are 3 levels of BLAS functions.
<ul>
<li><a href="http://www.netlib.org/blas/#_level_1">Level 1</a>: vector-vector operation</li>
<li><a href="http://www.netlib.org/blas/#_level_2">Level 2</a>: matrix-vector operation</li>
<li><a href="http://www.netlib.org/blas/#_level_3">Level 3</a>: matrix-matrix operation</li>
</ul></li>
</ul>
<table style="width:100%;">
<colgroup>
<col style="width: 6%">
<col style="width: 36%">
<col style="width: 11%">
<col style="width: 39%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Level</th>
<th>Example operation</th>
<th>Name</th>
<th>Dimension</th>
<th>Flops</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\(\alpha \gets \mathbf{x}^T \mathbf{y}\)</span></td>
<td>dot product</td>
<td><span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^n\)</span></td>
<td><span class="math inline">\(2n\)</span></td>
</tr>
<tr class="even">
<td>1</td>
<td><span class="math inline">\(\mathbf{y} \gets \mathbf{y} + \alpha \mathbf{x}\)</span></td>
<td>axpy</td>
<td><span class="math inline">\(\alpha \in \mathbb{R}\)</span>, <span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^n\)</span></td>
<td><span class="math inline">\(2n\)</span></td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2">

<table style="width:100%;">
<colgroup>
<col style="width: 6%">
<col style="width: 36%">
<col style="width: 11%">
<col style="width: 39%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Level</th>
<th>Example operation</th>
<th>Name</th>
<th>Dimension</th>
<th>Flops</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td><span class="math inline">\(\mathbf{y} \gets \mathbf{y} + \mathbf{A} \mathbf{x}\)</span></td>
<td>gaxpy</td>
<td><span class="math inline">\(\mathbf{A} \in \mathbb{R}^{m \times n}\)</span>, <span class="math inline">\(\mathbf{x} \in \mathbb{R}^n\)</span>, <span class="math inline">\(\mathbf{y} \in \mathbb{R}^m\)</span></td>
<td><span class="math inline">\(2mn\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\(\mathbf{A} \gets \mathbf{A} + \mathbf{y} \mathbf{x}^T\)</span></td>
<td>rank one update</td>
<td><span class="math inline">\(\mathbf{A} \in \mathbb{R}^{m \times n}\)</span>, <span class="math inline">\(\mathbf{x} \in \mathbb{R}^n\)</span>, <span class="math inline">\(\mathbf{y} \in \mathbb{R}^m\)</span></td>
<td><span class="math inline">\(2mn\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td><span class="math inline">\(\mathbf{C} \gets \mathbf{C} + \mathbf{A} \mathbf{B}\)</span></td>
<td>matrix multiplication</td>
<td><span class="math inline">\(\mathbf{A} \in \mathbb{R}^{m \times p}\)</span>, <span class="math inline">\(\mathbf{B} \in \mathbb{R}^{p \times n}\)</span>, <span class="math inline">\(\mathbf{C} \in \mathbb{R}^{m \times n}\)</span></td>
<td><span class="math inline">\(2mnp\)</span></td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2">

<ul>
<li>Typical BLAS functions support single precision (S), double precision (D), complex (C), and double complex (Z).</li>
</ul>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
<blockquote>
<p><strong>The form of a mathematical expression and the way the expression should be evaluated in actual practice may be quite different.</strong><br>
– James Gentle, <em>Matrix Algebra</em>, Springer, New York (2007).</p>
</blockquote>
<p>Some operations <em>appear</em> as level-3 but indeed are level-2.</p>
</section>
<section class="slide level2">

<h3 id="example-1">Example 1</h3>
<p>A common operation in statistics is column scaling or row scaling <span class="math display">\[
\begin{eqnarray*}
    \mathbf{A} &amp;=&amp; \mathbf{A} \mathbf{D} \quad \text{(column scaling)} \\
    \mathbf{A} &amp;=&amp; \mathbf{D} \mathbf{A} \quad \text{(row scaling)},
\end{eqnarray*}
\]</span> where <span class="math inline">\(\mathbf{D}\)</span> is diagonal. For example, in generalized linear models (GLMs), the Fisher information matrix takes the form<br>
<span class="math display">\[
\mathbf{X}^T \mathbf{W} \mathbf{X},
\]</span> where <span class="math inline">\(\mathbf{W}\)</span> is a diagonal matrix with observation weights on diagonal.</p>
</section>
<section class="slide level2">

<p>Column and row scalings are essentially level-2 operations!</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">Random</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>) <span class="co"># seed</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>n <span class="op">=</span> <span class="fl">2000</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>A <span class="op">=</span> <span class="fu">rand</span>(n, n) <span class="co"># n-by-n matrix</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>d <span class="op">=</span> <span class="fu">rand</span>(n)  <span class="co"># n vector</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>D <span class="op">=</span> <span class="fu">Diagonal</span>(d) <span class="co"># diagonal matrix with d as diagonal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>2000×2000 Diagonal{Float64, Vector{Float64}}:
 0.919181   ⋅         ⋅         ⋅        …   ⋅         ⋅          ⋅ 
  ⋅        0.426019   ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅        0.746586   ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅        0.819201      ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅        …   ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅        …   ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
 ⋮                                       ⋱                       
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅        …   ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅        …   ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅           0.572021   ⋅          ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅        0.0403848   ⋅ 
  ⋅         ⋅         ⋅         ⋅            ⋅         ⋅         0.141618</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1"></a>Dfull <span class="op">=</span> <span class="fu">convert</span>(<span class="dt">Matrix</span>, D) <span class="co"># convert to full matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>2000×2000 Matrix{Float64}:
 0.919181  0.0       0.0       0.0       …  0.0       0.0        0.0
 0.0       0.426019  0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.746586  0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.819201     0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0       …  0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0       …  0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 ⋮                                       ⋱                       
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0       …  0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0       …  0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.0
 0.0       0.0       0.0       0.0          0.572021  0.0        0.0
 0.0       0.0       0.0       0.0          0.0       0.0403848  0.0
 0.0       0.0       0.0       0.0          0.0       0.0        0.141618</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># this is calling BLAS routine for matrix multiplication: O(n^3) flops</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="pp">@benchmark</span> <span class="op">$</span>A <span class="op">*</span> <span class="op">$</span>Dfull</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 44 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">101.968 ms</span> … <span class="ansi-magenta-fg">133.653 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 6.36%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">114.603 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">114.906 ms</span> ± <span class="ansi-green-fg">  7.424 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>2.32% ± 3.32%
       ▃  ▃     ▃      ▃  <span class="ansi-blue-fg">▃</span><span class="ansi-green-fg"> </span>     █         █  ▃                  
  ▇▁▁▁▇█▇▇█▇▁▇▁▇█▇▇▁▇▇▇█▇▇<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">▇</span>▁▇▇▁▇█▇▇▇▁▁▇▁▁▁█▁▇█▇▁▇▁▁▁▁▁▁▁▁▁▁▁▁▇ ▁
  102 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          134 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">30.52 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">2</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># dispatch to special method for diagonal matrix multiplication.</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># columnwise scaling: O(n^2) flops</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="pp">@benchmark</span> <span class="op">$</span>A <span class="op">*</span> <span class="op">$</span>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 614 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">4.590 ms</span> … <span class="ansi-magenta-fg">21.064 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 35.73%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">5.453 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">8.127 ms</span> ± <span class="ansi-green-fg"> 3.968 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>31.27% ± 26.77%
   ▁▁█▃<span class="ansi-blue-fg"> </span>            <span class="ansi-green-fg"> </span>                                         
  ▇████<span class="ansi-blue-fg">▅</span>▄▄▃▂▃▁▂▁▁▁▁▁<span class="ansi-green-fg">▁</span>▂▁▁▁▁▁▁▂▁▁▁▁▁▁▁▁▁▁▁▂▁▂▄▄▅▇▇▄▄▃▂▃▃▃▂▂▂▂▂ ▃
  4.59 ms<span class="ansi-bright-black-fg">        Histogram: frequency by time</span>        15.7 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">30.52 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">2</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># in-place: avoid allocating space for result</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># rmul!: compute matrix-matrix product AB, overwriting A, and return the result.</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="pp">@benchmark</span> <span class="fu">rmul!</span>(A, D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 555 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">6.985 ms</span> … <span class="ansi-magenta-fg">17.670 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">8.871 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">9.005 ms</span> ± <span class="ansi-green-fg"> 1.304 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
     ▃ ▃ ▃▄▃▄▃▂▃▅<span class="ansi-blue-fg"> </span><span class="ansi-green-fg"> </span>▃▃▃ ▅█▅▂                                   
  ▅▅▆█▇█▇████████<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">█</span>████████▅▆▃▂▃▂▃▁▂▁▂▁▁▁▁▁▁▁▁▁▁▁▂▁▁▁▃▁▂▂▁▁▂ ▄
  6.99 ms<span class="ansi-bright-black-fg">        Histogram: frequency by time</span>        14.5 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p><strong>Note:</strong> In R, <code>diag(d)</code> will create a full (dense) matrix. Be cautious using <code>diag</code> function: do we really need a full diagonal matrix?</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1"></a><span class="im">using</span> <span class="bu">RCall</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>R<span class="st">"""</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="st">d &lt;- runif(5)</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="st">diag(d)</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>RObject{RealSxp}
          [,1]      [,2]      [,3]     [,4]      [,5]
[1,] 0.3654198 0.0000000 0.0000000 0.000000 0.0000000
[2,] 0.0000000 0.8655639 0.0000000 0.000000 0.0000000
[3,] 0.0000000 0.0000000 0.3504395 0.000000 0.0000000
[4,] 0.0000000 0.0000000 0.0000000 0.831144 0.0000000
[5,] 0.0000000 0.0000000 0.0000000 0.000000 0.5096795</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="example-2">Example 2</h3>
<p>Inner product between two matrices <span class="math inline">\(\mathbf{A}, \mathbf{B} \in \mathbb{R}^{m \times n}\)</span> is often written as</p>
<p><span class="math display">\[
    \langle \mathbf{A}, \mathbf{B} \rangle
    = \sum_{i,j} \mathbf{A}_{ij}\mathbf{B}_{ij}
    = \text{trace}(\mathbf{A}^T \mathbf{B})
    = \text{trace}(\mathbf{B} \mathbf{A}^T)
.
\]</span></p>
<p>They appear as level-3 operation (matrix multiplication with <span class="math inline">\(O(m^2n)\)</span> or <span class="math inline">\(O(mn^2)\)</span> flops).</p>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a>n <span class="op">=</span> <span class="fl">2000</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>A, B <span class="op">=</span> <span class="fu">randn</span>(n, n), <span class="fu">randn</span>(n, n)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co"># slow way to evaluate this thing</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="pp">@benchmark</span> <span class="fu">tr</span>(<span class="fu">transpose</span>(<span class="op">$</span>A) <span class="op">*</span> <span class="op">$</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 42 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">104.649 ms</span> … <span class="ansi-magenta-fg">145.683 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">118.936 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">121.451 ms</span> ± <span class="ansi-green-fg">  9.916 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>2.33% ± 3.18%
             ▃▃█ ▃▃ ▃  <span class="ansi-blue-fg"> </span>   <span class="ansi-green-fg"> </span>  ▃    ▃                             
  ▇▁▁▁▇▁▁▇▇▇▁███▇██▁█▇▇<span class="ansi-blue-fg">▇</span>▁▇▇<span class="ansi-green-fg">▇</span>▇▁█▁▇▁▇█▁▇▁▁▇▁▇▇▇▁▁▁▁▁▇▇▇▁▁▁▁▁▇▁▁▁▇ ▁
  105 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          146 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">30.52 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">2</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>But <span class="math inline">\(\langle \mathbf{A}, \mathbf{B} \rangle = \langle \text{vec}(\mathbf{A}), \text{vec}(\mathbf{B}) \rangle\)</span>. The latter is level-2 operation with <span class="math inline">\(O(mn)\)</span> flops.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1"></a><span class="pp">@benchmark</span> <span class="fu">dot</span>(<span class="op">$</span>A, <span class="op">$</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 3834 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">1.215 ms</span> … <span class="ansi-magenta-fg"> 10.489 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">1.248 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">1.292 ms</span> ± <span class="ansi-green-fg">374.393 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▅██▇▆▆<span class="ansi-blue-fg">▆</span>▆▅▅▄▄▄<span class="ansi-green-fg">▄</span>▃▂▂▂▂                                         ▂
  ██████<span class="ansi-blue-fg">█</span>██████<span class="ansi-green-fg">█</span>████████▇█▇▇▇▆▅▇▇▄▆▅▆▅▇▆▄▆▇▆███▆▆▆▄▄▄▆▄▆▆▄▄▃▅ █
  1.21 ms<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      1.57 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="example-3">Example 3</h3>
<p>Similarly <span class="math inline">\(\text{diag}(\mathbf{A}^T \mathbf{B})=\text{diag}(\sum_{j}\mathbf{A}_{ij}\mathbf{B}_{ij})\)</span> can be calculated in <span class="math inline">\(O(mn)\)</span> flops.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># slow way to evaluate this thing</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="pp">@benchmark</span> <span class="fu">diag</span>(<span class="fu">transpose</span>(<span class="op">$</span>A) <span class="op">*</span> <span class="op">$</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 38 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">105.460 ms</span> … <span class="ansi-magenta-fg">176.225 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">131.428 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">135.400 ms</span> ± <span class="ansi-green-fg"> 20.099 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>2.05% ± 2.95%
       █   ▄   ▁  ▁   <span class="ansi-blue-fg"> </span>     <span class="ansi-green-fg"> </span>        ▁ ▁  ▁     ▁                
  ▆▁▁▁▆█▆▁▆█▁▁▆█▆▁█▆▁▆<span class="ansi-blue-fg">▁</span>▁▁▁▁▆<span class="ansi-green-fg">▁</span>▁▁▁▁▆▁▆▆█▁█▁▆█▆▁▁▆▁█▁▆▁▁▁▁▆▆▁▁▁▁▁▆ ▁
  105 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          176 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">30.53 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">3</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># smarter</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="pp">@benchmark</span> <span class="fu">Diagonal</span>(<span class="fu">vec</span>(<span class="fu">sum</span>(<span class="op">$</span>A <span class="op">.*</span> <span class="op">$</span>B, dims<span class="op">=</span><span class="fl">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 426 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 7.351 ms</span> … <span class="ansi-magenta-fg">27.917 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 30.06%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold"> 8.809 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">11.720 ms</span> ± <span class="ansi-green-fg"> 4.593 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>23.23% ± 21.90%
  ▂▅▆█▆<span class="ansi-blue-fg">▄</span>▁        <span class="ansi-green-fg"> </span>             ▃▁ ▄▄▃▂                         
  █████<span class="ansi-blue-fg">█</span>████▇▅▄▄▁<span class="ansi-green-fg">▄</span>▁▁▁▁▁▁▁▁▁▄▁▁▆███████▇█▇▅▅▁▄▁▁▄▁▁▁▁▅▁▁▁▁▁▄▄▄ ▇
  7.35 ms<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      24.9 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">30.53 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">5</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>To get rid of allocation of intermediate array at all, we can just write a double loop or use <code>dot</code> function.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">function</span> <span class="fu">diag_matmul</span>(A, B)</span>
<span id="cb37-2"><a href="#cb37-2"></a>    m, n <span class="op">=</span> <span class="fu">size</span>(A)</span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="pp">@assert</span> <span class="fu">size</span>(B) <span class="op">==</span> (m, n) <span class="st">"A and B should have same size"</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="co"># @views: Convert every array-slicing operation in the given expression to return a view.</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>    <span class="co"># See below for avoiding memory allocation</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>    <span class="pp">@views</span> d <span class="op">=</span> [<span class="fu">dot</span>(A[<span class="op">:</span>, j], B[<span class="op">:</span>, j]) for j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n]</span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co">#    d = zeros(eltype(A), n)</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co">#    for j in 1:n, i in 1:m</span></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="co">#        d[j] += A[i, j] * B[i, j]</span></span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="co">#    end</span></span>
<span id="cb37-11"><a href="#cb37-11"></a>    <span class="fu">Diagonal</span>(d)</span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="kw">end</span></span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="pp">@benchmark</span> <span class="fu">diag_matmul</span>(<span class="op">$</span>A, <span class="op">$</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 1972 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">2.363 ms</span> … <span class="ansi-magenta-fg"> 11.718 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">2.442 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">2.526 ms</span> ± <span class="ansi-green-fg">604.918 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▆██<span class="ansi-blue-fg">▇</span>▆▄<span class="ansi-green-fg">▃</span>▂ ▁   ▁▁                                             ▁
  ███<span class="ansi-blue-fg">█</span>██<span class="ansi-green-fg">█</span>████████▇▆▆▅▆▆▁▁▄▅▁▁▁▁▄▅▁▁▄▄▁▁▄▅▄▁▁▄▁▁▁▁▁▄▁▁▁▁▁▁▁▄▁▄ █
  2.36 ms<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      4.01 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">15.75 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</section>
<section id="memory-hierarchy-and-level-3-fraction" class="slide level2">
<h2>Memory hierarchy and level-3 fraction</h2>

<img data-src="./cpu_die.png" width="600" class="r-stretch quarto-figure-center"><p class="caption">Inside a CPU</p></section>
<section class="slide level2">


<img data-src="https://i.imgur.com/suD65Rs.png" width="400" class="r-stretch quarto-figure-center"><p class="caption">Memory hierarchy. Source: https://cs.brown.edu/courses/csci1310/2020/assign/labs/lab4.html</p></section>
<section class="slide level2">

<p><strong>A Key to high performance is effective use of memory hierarchy. This is true for all architectures.</strong></p>
<ul>
<li><p>Flop count is not the sole determinant of algorithm efficiency. Another important factor is data movement through the memory hierarchy.</p></li>
<li><p>For example, my laptop’s Intel i5-8279U CPU has a theoretical throughput of 150 DP GFLOPS but a max memory bandwidth of 37.5GB/s.</p></li>
<li><p>Q: Can we keep CPU cores busy with enough deliveries of matrix data and ship the results to memory fast enough to avoid backlog?</p>
<ul>
<li>A: use <strong>high-level BLAS</strong> as much as possible.</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<table style="width:100%;">
<colgroup>
<col style="width: 26%">
<col style="width: 50%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>BLAS</th>
<th>Dimension</th>
<th>Memory refs</th>
<th>Flops</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Level 1: <span class="math inline">\(\mathbf{y} \gets \mathbf{y} + \alpha \mathbf{x}\)</span></td>
<td><span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^n\)</span></td>
<td><span class="math inline">\(3n\)</span></td>
<td><span class="math inline">\(2n\)</span></td>
<td>3:2</td>
</tr>
<tr class="even">
<td>Level 2: <span class="math inline">\(\mathbf{y} \gets \mathbf{y} + \mathbf{A} \mathbf{x}\)</span></td>
<td><span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^n\)</span>, <span class="math inline">\(\mathbf{A} \in \mathbb{R}^{n \times n}\)</span></td>
<td><span class="math inline">\(n^2\)</span></td>
<td><span class="math inline">\(2n^2\)</span></td>
<td>1:2</td>
</tr>
<tr class="odd">
<td>Level 3: <span class="math inline">\(\mathbf{C} \gets \mathbf{C} + \mathbf{A} \mathbf{B}\)</span></td>
<td><span class="math inline">\(\mathbf{A}, \mathbf{B}, \mathbf{C} \in\mathbb{R}^{n \times n}\)</span></td>
<td><span class="math inline">\(4n^2\)</span></td>
<td><span class="math inline">\(2n^3\)</span></td>
<td>2:n</td>
</tr>
</tbody>
</table>
<ul>
<li>Higher level BLAS (3 or 2) make more effective use of arithmetic logic units (ALU) by keeping them busy. This is called the surface-to-volume effect.</li>
</ul>
</section>
<section class="slide level2">


<img data-src="./blas_throughput2.png" width="600" class="r-stretch quarto-figure-center"><p class="caption">BLAS throughput by level</p></section>
<section id="effect-of-data-layout" class="slide level2">
<h2>Effect of data layout</h2>
<ul>
<li><p>Data layout in memory affects algorithmic efficiency too. It is much faster to move chunks of data in memory than retrieving/writing scattered data.</p></li>
<li><p>Storage mode: <strong>column-major</strong> (Fortran, Matlab, R, Julia) vs <strong>row-major</strong> (C/C++).</p></li>
<li><p><strong>Cache line</strong> is the minimum amount of cache which can be loaded from and stored to memory.</p>
<ul>
<li>x86 CPUs: 64 bytes<br>
</li>
<li>ARM CPUs: 32 bytes</li>
</ul></li>
</ul>
</section>
<section class="slide level2">


<img data-src="https://patterns.eecs.berkeley.edu/wordpress/wp-content/uploads/2013/04/dense02.png" width="500" class="r-stretch quarto-figure-center"><p class="caption">Cache line. Source: <a href="https://patterns.eecs.berkeley.edu/?page_id=158" class="uri">https://patterns.eecs.berkeley.edu/?page_id=158</a></p></section>
<section class="slide level2">

<ul>
<li><p>Accessing <em>column-major</em> stored matrix by <em>rows</em> (<code>ij</code> looping) causes lots of <strong>cache misses</strong>.</p></li>
<li><p>Take matrix multiplication as an example: <span class="math display">\[
\mathbf{C} \gets \mathbf{C} + \mathbf{A} \mathbf{B}, \quad \mathbf{A} \in \mathbb{R}^{m \times p}, \mathbf{B} \in \mathbb{R}^{p \times n}, \mathbf{C} \in \mathbb{R}^{m \times n}.
\]</span></p></li>
<li><p>Assume the storage is column-major, such as in Julia. There are 6 variants of the algorithms according to the order in the triple loops.</p></li>
</ul>
</section>
<section class="slide level2">

<ol type="1">
<li><code>jki</code> or <code>kji</code> looping:</li>
</ol>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># innermost loop</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m</span>
<span id="cb38-3"><a href="#cb38-3"></a>    C[i, j] <span class="op">=</span> C[i, j] <span class="op">+</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><code>ikj</code> or <code>kij</code> looping:</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># innermost loop        </span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="cf">for</span> j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb39-3"><a href="#cb39-3"></a>    C[i, j] <span class="op">=</span> C[i, j] <span class="op">+</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><code>ijk</code> or <code>jik</code> looping:</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># innermost loop        </span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb40-3"><a href="#cb40-3"></a>    C[i, j] <span class="op">=</span> C[i, j] <span class="op">+</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

<ul>
<li>We pay attention to the innermost loop, where the vector calculation occurs. The associated <strong>stride</strong> when accessing the three matrices in memory (assuming column-major storage) is</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Variant</th>
<th>A Stride</th>
<th>B Stride</th>
<th>C Stride</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>jki</code> or <code>kji</code></td>
<td>Unit</td>
<td>0</td>
<td>Unit</td>
</tr>
<tr class="even">
<td><code>ikj</code> or <code>kij</code></td>
<td>0</td>
<td>Non-Unit</td>
<td>Non-Unit</td>
</tr>
<tr class="odd">
<td><code>ijk</code> or <code>jik</code></td>
<td>Non-Unit</td>
<td>Unit</td>
<td>0</td>
</tr>
</tbody>
</table>
<ul>
<li>Apparently the variants <code>jki</code> or <code>kji</code> are preferred.</li>
</ul>
</section>
<section class="slide level2">

<p>Let’s test.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a href="#cb41-1"></a><span class="st">"""</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="st">    matmul_by_loop!(A, B, C, order)</span></span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="st">Overwrite `C` by `A * B`. `order` indicates the looping order for triple loop.</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="st">"""</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="kw">function</span> <span class="fu">matmul_by_loop!</span>(A<span class="op">::</span><span class="dt">Matrix</span>, B<span class="op">::</span><span class="dt">Matrix</span>, C<span class="op">::</span><span class="dt">Matrix</span>, order<span class="op">::</span><span class="dt">String</span>)</span>
<span id="cb41-7"><a href="#cb41-7"></a>    </span>
<span id="cb41-8"><a href="#cb41-8"></a>    m <span class="op">=</span> <span class="fu">size</span>(A, <span class="fl">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a>    p <span class="op">=</span> <span class="fu">size</span>(A, <span class="fl">2</span>)</span>
<span id="cb41-10"><a href="#cb41-10"></a>    n <span class="op">=</span> <span class="fu">size</span>(B, <span class="fl">2</span>)</span>
<span id="cb41-11"><a href="#cb41-11"></a>    <span class="fu">fill!</span>(C, <span class="fl">0</span>)</span>
<span id="cb41-12"><a href="#cb41-12"></a>    </span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"jki"</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>        <span class="cf">for</span> j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n, k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m</span>
<span id="cb41-15"><a href="#cb41-15"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-16"><a href="#cb41-16"></a>        <span class="cf">end</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>    <span class="cf">end</span></span>
<span id="cb41-18"><a href="#cb41-18"></a></span>
<span id="cb41-19"><a href="#cb41-19"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"kji"</span></span>
<span id="cb41-20"><a href="#cb41-20"></a>        <span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m</span>
<span id="cb41-21"><a href="#cb41-21"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-22"><a href="#cb41-22"></a>        <span class="cf">end</span></span>
<span id="cb41-23"><a href="#cb41-23"></a>    <span class="cf">end</span></span>
<span id="cb41-24"><a href="#cb41-24"></a>    </span>
<span id="cb41-25"><a href="#cb41-25"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"ikj"</span></span>
<span id="cb41-26"><a href="#cb41-26"></a>        <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m, k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb41-27"><a href="#cb41-27"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-28"><a href="#cb41-28"></a>        <span class="cf">end</span></span>
<span id="cb41-29"><a href="#cb41-29"></a>    <span class="cf">end</span></span>
<span id="cb41-30"><a href="#cb41-30"></a></span>
<span id="cb41-31"><a href="#cb41-31"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"kij"</span></span>
<span id="cb41-32"><a href="#cb41-32"></a>        <span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb41-33"><a href="#cb41-33"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-34"><a href="#cb41-34"></a>        <span class="cf">end</span></span>
<span id="cb41-35"><a href="#cb41-35"></a>    <span class="cf">end</span></span>
<span id="cb41-36"><a href="#cb41-36"></a>    </span>
<span id="cb41-37"><a href="#cb41-37"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"ijk"</span></span>
<span id="cb41-38"><a href="#cb41-38"></a>        <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n, k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb41-39"><a href="#cb41-39"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-40"><a href="#cb41-40"></a>        <span class="cf">end</span></span>
<span id="cb41-41"><a href="#cb41-41"></a>    <span class="cf">end</span></span>
<span id="cb41-42"><a href="#cb41-42"></a>    </span>
<span id="cb41-43"><a href="#cb41-43"></a>    <span class="cf">if</span> order <span class="op">==</span> <span class="st">"jik"</span></span>
<span id="cb41-44"><a href="#cb41-44"></a>        <span class="cf">for</span> j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>m, k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb41-45"><a href="#cb41-45"></a>            C[i, j] <span class="op">+=</span> A[i, k] <span class="op">*</span> B[k, j]</span>
<span id="cb41-46"><a href="#cb41-46"></a>        <span class="cf">end</span></span>
<span id="cb41-47"><a href="#cb41-47"></a>    <span class="cf">end</span></span>
<span id="cb41-48"><a href="#cb41-48"></a>    </span>
<span id="cb41-49"><a href="#cb41-49"></a><span class="kw">end</span></span>
<span id="cb41-50"><a href="#cb41-50"></a></span>
<span id="cb41-51"><a href="#cb41-51"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb41-52"><a href="#cb41-52"></a></span>
<span id="cb41-53"><a href="#cb41-53"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>)</span>
<span id="cb41-54"><a href="#cb41-54"></a>m, p, n <span class="op">=</span> <span class="fl">2000</span>, <span class="fl">100</span>, <span class="fl">2000</span></span>
<span id="cb41-55"><a href="#cb41-55"></a>A <span class="op">=</span> <span class="fu">rand</span>(m, p)</span>
<span id="cb41-56"><a href="#cb41-56"></a>B <span class="op">=</span> <span class="fu">rand</span>(p, n)</span>
<span id="cb41-57"><a href="#cb41-57"></a>C <span class="op">=</span> <span class="fu">zeros</span>(m, n);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li><code>jki</code> and <code>kji</code> looping:</li>
</ul>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"jki"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 19 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">264.654 ms</span> … <span class="ansi-magenta-fg">290.569 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">275.690 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">276.962 ms</span> ± <span class="ansi-green-fg">  7.307 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▁  ▁ ▁            ▁▁█▁<span class="ansi-blue-fg">▁</span>  ▁   <span class="ansi-green-fg"> </span>  ▁▁ ▁ ▁   █        ▁      ▁  ▁  
  █▁▁█▁█▁▁▁▁▁▁▁▁▁▁▁▁████<span class="ansi-blue-fg">█</span>▁▁█▁▁▁<span class="ansi-green-fg">▁</span>▁▁██▁█▁█▁▁▁█▁▁▁▁▁▁▁▁█▁▁▁▁▁▁█▁▁█ ▁
  265 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          291 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"kji"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 16 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">315.432 ms</span> … <span class="ansi-magenta-fg">340.858 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">324.886 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">325.659 ms</span> ± <span class="ansi-green-fg">  5.261 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▁            ▁  ▁ ▁ █▁<span class="ansi-blue-fg">▁</span>▁▁<span class="ansi-green-fg"> </span> ▁▁█     ▁                        ▁  
  █▁▁▁▁▁▁▁▁▁▁▁▁█▁▁█▁█▁██<span class="ansi-blue-fg">█</span>██<span class="ansi-green-fg">▁</span>▁███▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█ ▁
  315 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          341 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li><code>ikj</code> and <code>kij</code> looping:</li>
</ul>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"ikj"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 3 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">2.321 s</span> … <span class="ansi-magenta-fg">  2.350 s</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">2.342 s              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">2.338 s</span> ± <span class="ansi-green-fg">14.481 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>                                <span class="ansi-green-fg"> </span>      █               █  
  <span class="ansi-blue-fg">█</span>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁<span class="ansi-green-fg">▁</span>▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█ ▁
  2.32 s<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>        2.35 s <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"kij"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 3 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">2.369 s</span> … <span class="ansi-magenta-fg">  2.393 s</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">2.372 s              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">2.378 s</span> ± <span class="ansi-green-fg">13.230 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>      █              <span class="ansi-green-fg"> </span>                                 █  
  <span class="ansi-blue-fg">█</span>▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁<span class="ansi-green-fg">▁</span>▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█ ▁
  2.37 s<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>        2.39 s <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li><code>ijk</code> and <code>jik</code> looping:</li>
</ul>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"ijk"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 11 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">459.863 ms</span> … <span class="ansi-magenta-fg">488.570 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">468.752 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">470.201 ms</span> ± <span class="ansi-green-fg">  9.044 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▁ ▁       █ ▁<span class="ansi-blue-fg"> </span>    ▁ ▁ <span class="ansi-green-fg"> </span>▁      ▁                    ▁        ▁  
  █▁█▁▁▁▁▁▁▁█▁█<span class="ansi-blue-fg">▁</span>▁▁▁▁█▁█▁<span class="ansi-green-fg">▁</span>█▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁█ ▁
  460 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          489 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1"></a><span class="pp">@benchmark</span> <span class="fu">matmul_by_loop!</span>(<span class="op">$</span>A, <span class="op">$</span>B, <span class="op">$</span>C, <span class="st">"ijk"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 11 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">458.816 ms</span> … <span class="ansi-magenta-fg">490.466 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">473.290 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">474.217 ms</span> ± <span class="ansi-green-fg"> 10.033 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▁     ▁   ▁         ▁      █<span class="ansi-blue-fg"> </span> <span class="ansi-green-fg"> </span> ▁          ▁   ▁▁           ▁  
  █▁▁▁▁▁█▁▁▁█▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁█<span class="ansi-blue-fg">▁</span>▁<span class="ansi-green-fg">▁</span>▁█▁▁▁▁▁▁▁▁▁▁█▁▁▁██▁▁▁▁▁▁▁▁▁▁▁█ ▁
  459 ms<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>          490 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Julia wraps BLAS library for matrix multiplication. We see BLAS library wins the <code>jki</code> and <code>kji</code> looping by a large margin (multi-threading, optimized cache uses, etc).</li>
</ul>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1"></a><span class="pp">@benchmark</span> <span class="fu">mul!</span>(<span class="op">$</span>C, <span class="op">$</span>A, <span class="op">$</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 746 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">5.530 ms</span> … <span class="ansi-magenta-fg">18.178 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">6.243 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">6.685 ms</span> ± <span class="ansi-green-fg"> 1.465 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▂▂▇██<span class="ansi-blue-fg"> </span> <span class="ansi-green-fg"> </span>                                                    
  █████<span class="ansi-blue-fg">▇</span>▇<span class="ansi-green-fg">▆</span>▆▇▆▆▅▄▃▃▃▃▃▃▁▂▃▂▃▂▁▂▁▂▁▁▁▁▂▂▁▁▁▁▁▁▁▁▂▁▂▁▁▁▁▁▁▁▂▁▁▂ ▃
  5.53 ms<span class="ansi-bright-black-fg">        Histogram: frequency by time</span>        14.7 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># direct call of BLAS wrapper function</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="pp">@benchmark</span> <span class="bu">LinearAlgebra</span>.BLAS.<span class="fu">gemm!</span>(<span class="ch">'N'</span>, <span class="ch">'N'</span>, <span class="fl">1.0</span>, <span class="op">$</span>A, <span class="op">$</span>B, <span class="fl">0.0</span>, <span class="op">$</span>C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 795 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">5.369 ms</span> … <span class="ansi-magenta-fg">18.630 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">6.008 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">6.275 ms</span> ± <span class="ansi-green-fg"> 1.352 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
     █<span class="ansi-blue-fg">▂</span><span class="ansi-green-fg"> </span>                                                      
  ▇▅▇█<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">▅</span>▄▃▃▂▃▃▃▂▂▂▂▂▁▂▂▂▂▁▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▂▂▂ ▂
  5.37 ms<span class="ansi-bright-black-fg">        Histogram: frequency by time</span>        15.3 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section id="blas-in-r" class="slide level2">
<h2>BLAS in R</h2>
<ul>
<li><strong>Tip for R users</strong>. Standard R distribution from CRAN uses a very out-dated BLAS/LAPACK library.</li>
</ul>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1"></a><span class="im">using</span> <span class="bu">RCall</span></span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a>R<span class="st">"""</span></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="st">library("microbenchmark")</span></span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="st">microbenchmark(</span><span class="sc">$</span>A<span class="st"> %*% </span><span class="sc">$</span>B<span class="st">)</span></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>RObject{VecSxp}
Unit: milliseconds
                expr      min       lq     mean   median       uq      max
 `#JL`$A %*% `#JL`$B 219.3789 223.8206 239.5237 230.1315 233.6014 1036.788
 neval
   100</code></pre>
</div>
</div>
<ul>
<li>Re-building R from scratch using <a href="https://github.com/david-cortes/R-openblas-in-windows">OpenBLAS</a> or <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/using-onemkl-with-r.html">MKL</a> will immediately boost linear algebra performance in R.</li>
</ul>
</section>
<section id="avoiding-memory-allocation" class="slide level2">
<h2>Avoiding memory allocation</h2>
<ol type="1">
<li><strong>Transposing</strong> a matrix is an expensive memory operation.
<ul>
<li>In R, the command</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>    <span class="fu">t</span>(A) <span class="sc">%*%</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
will first transpose <code>A</code> then perform matrix multiplication, causing unnecessary memory allocation
<ul>
<li>Julia is smart to avoid transposing matrix if possible.</li>
</ul></li>
</ol>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">BenchmarkTools</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>)</span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a>n <span class="op">=</span> <span class="fl">1000</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>A <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb53-6"><a href="#cb53-6"></a>x <span class="op">=</span> <span class="fu">rand</span>(n);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">typeof</span>(<span class="fu">transpose</span>(A))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Transpose{Float64, Matrix{Float64}}</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">fieldnames</span>(<span class="fu">typeof</span>(<span class="fu">transpose</span>(A)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(:parent,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># same data in tranpose(A) and original matrix A</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="fu">pointer</span>(<span class="fu">transpose</span>(A).parent), <span class="fu">pointer</span>(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(Ptr{Float64} @0x00007f91a2856000, Ptr{Float64} @0x00007f91a2856000)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># dispatch to BLAS</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co"># does *not* actually transpose the matrix</span></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="pp">@benchmark</span> <span class="fu">transpose</span>(<span class="op">$</span>A) <span class="op">*</span> <span class="op">$</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 74.097 μs</span> … <span class="ansi-magenta-fg"> 3.289 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold"> 93.688 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">100.476 μs</span> ± <span class="ansi-green-fg">58.996 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
          ▁▃▆▇▇██<span class="ansi-blue-fg">▅</span>▃▁  <span class="ansi-green-fg"> </span>                                         
  ▁▁▁▂▂▃▅▇███████<span class="ansi-blue-fg">█</span>██▇▆<span class="ansi-green-fg">▅</span>▄▄▄▄▄▄▄▃▂▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁ ▃
  74.1 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>          154 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">7.94 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># pre-allocating output storage saves memory allocation</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>out <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">size</span>(A, <span class="fl">2</span>))</span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="pp">@benchmark</span> <span class="fu">mul!</span>(<span class="op">$</span>out, <span class="fu">transpose</span>(<span class="op">$</span>A), <span class="op">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 76.626 μs</span> … <span class="ansi-magenta-fg"> 7.861 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">115.282 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">117.125 μs</span> ± <span class="ansi-green-fg">93.175 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
                      ▂▂▃▄▄▄▆▆<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">▇</span>▆▆▅▅▃▂▁                         
  ▁▁▁▁▂▂▃▄▃▅▅▅▅▅▅▅▆▆▇█████████<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">█</span>████████▇▆▆▄▄▄▃▃▂▂▂▂▂▁▁▁▁▁▁▁▁▁ ▄
  76.6 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>          159 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># or call BLAS wrapper directly</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="pp">@benchmark</span> <span class="bu">LinearAlgebra</span>.BLAS.<span class="fu">gemv!</span>(<span class="ch">'T'</span>, <span class="fl">1.0</span>, <span class="op">$</span>A, <span class="op">$</span>x, <span class="fl">0.0</span>, <span class="op">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">75.228 μs</span> … <span class="ansi-magenta-fg"> 6.008 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">93.243 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">99.234 μs</span> ± <span class="ansi-green-fg">85.271 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
          ▃▄▆▆▇█<span class="ansi-blue-fg">▆</span>▅▂▁ <span class="ansi-green-fg"> </span>                                         
  ▁▁▂▂▃▅▆▇██████<span class="ansi-blue-fg">█</span>███▇<span class="ansi-green-fg">▇</span>▆▅▄▄▄▄▄▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁ ▃
  75.2 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>         149 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<ol start="2" type="1">
<li><p><a href="https://docs.julialang.org/en/v1/base/arrays/#Broadcast-and-vectorization-1">Broadcasting</a> in Julia achieves vectorized code without creating intermediate arrays.</p>
<p>Suppose we want to calculate elementsize maximum of absolute values of two large arrays. In R, the command</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(X), <span class="fu">abs</span>(Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>will create two intermediate arrays and then one result array.</p></li>
</ol>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb64-1"><a href="#cb64-1"></a><span class="im">using</span> <span class="bu">RCall</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>)</span>
<span id="cb64-3"><a href="#cb64-3"></a>X, Y <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">1000</span>, <span class="fl">1000</span>), <span class="fu">rand</span>(<span class="fl">1000</span>, <span class="fl">1000</span>)</span>
<span id="cb64-4"><a href="#cb64-4"></a></span>
<span id="cb64-5"><a href="#cb64-5"></a>R<span class="st">"""</span></span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="st">library(microbenchmark)</span></span>
<span id="cb64-7"><a href="#cb64-7"></a><span class="st">microbenchmark(max(abs(</span><span class="sc">$</span>X<span class="st">), abs(</span><span class="sc">$</span>Y<span class="st">)))</span></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>RObject{VecSxp}
Unit: milliseconds
                            expr      min       lq     mean   median       uq
 max(abs(`#JL`$X), abs(`#JL`$Y)) 5.246855 5.861161 10.09725 7.250268 8.687335
      max neval
 91.96797   100</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>In Julia, dot operations are fused so no intermediate arrays are created.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># no intermediate arrays created, only result array created</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="pp">@benchmark</span> <span class="fu">max</span>.(<span class="fu">abs</span>.(<span class="op">$</span>X), <span class="fu">abs</span>.(<span class="op">$</span>Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 2988 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">769.503 μs</span> … <span class="ansi-magenta-fg">17.001 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 88.54%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">  1.190 ms              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">  1.666 ms</span> ± <span class="ansi-green-fg"> 1.394 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>27.93% ± 24.88%
  ▄▂▁▂█<span class="ansi-blue-fg">▆</span>▅▃▂▁<span class="ansi-green-fg"> </span>                                    ▁▂▂▁▁         ▁
  █████<span class="ansi-blue-fg">█</span>████<span class="ansi-green-fg">█</span>▇▆▅▅▄▆▃▃▃▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▃▁▁▁▃▁▁▄▆██████▇▆▇▆▆▆▆ █
  770 μs<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      5.94 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">7.63 MiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">2</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Pre-allocating result array gets rid of memory allocation at all.</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>Z <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">size</span>(X)) <span class="co"># zero matrix of same size as X</span></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="pp">@benchmark</span> <span class="op">$</span>Z <span class="op">.=</span> <span class="fu">max</span>.(<span class="fu">abs</span>.(<span class="op">$</span>X), <span class="fu">abs</span>.(<span class="op">$</span>Y)) <span class="co"># .= (vs =) is important!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 6270 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">696.965 μs</span> … <span class="ansi-magenta-fg">  7.058 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">748.761 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">789.471 μs</span> ± <span class="ansi-green-fg">239.083 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
   █▅▃▁ <span class="ansi-blue-fg">▂</span>    <span class="ansi-green-fg"> </span>                                                   
  ██████<span class="ansi-blue-fg">█</span>█▆▅▅<span class="ansi-green-fg">▅</span>▄▅▄▄▄▄▃▃▄▃▃▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂ ▃
  697 μs<span class="ansi-bright-black-fg">           Histogram: frequency by time</span>         1.19 ms <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<ol start="3" type="1">
<li><a href="https://docs.julialang.org/en/v1/base/arrays/#Views-(SubArrays-and-other-view-types)-1">View</a> avoids creating extra copy of matrix data.</li>
</ol>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">123</span>)</span>
<span id="cb68-2"><a href="#cb68-2"></a>A <span class="op">=</span> <span class="fu">randn</span>(<span class="fl">1000</span>, <span class="fl">1000</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co"># sum entries in a sub-matrix</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="pp">@benchmark</span> <span class="fu">sum</span>(<span class="op">$</span>A[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 59.710 μs</span> … <span class="ansi-magenta-fg"> 12.666 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 96.62%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">284.233 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">310.682 μs</span> ± <span class="ansi-green-fg">447.952 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>11.33% ±  7.84%
  ▆▃▁   ▂               ▁▅▇█<span class="ansi-blue-fg">▇</span>▆▅<span class="ansi-green-fg">▄</span>▄▄▃▃▂▂▂▁▁▁ ▁                    ▂
  ███▇█▆█▆▇▆▃▄▃▁▃▁▃▁▁▃▄▆████<span class="ansi-blue-fg">█</span>██<span class="ansi-green-fg">█</span>█████████████▇██▇▇▇▇▆▆▆▄▆▅▃▄▁▅▄ █
  59.7 μs<span class="ansi-bright-black-fg">       </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>        590 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">488.36 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">2</span>.</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># view avoids creating a separate sub-matrix</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="pp">@benchmark</span> <span class="fu">sum</span>(<span class="pp">@view</span> <span class="op">$</span>A[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">78.089 μs</span> … <span class="ansi-magenta-fg"> 2.672 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">78.242 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">85.713 μs</span> ± <span class="ansi-green-fg">46.953 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>▆▂▁<span class="ansi-green-fg">▁</span>                                                       ▁
  <span class="ansi-blue-fg">█</span>███<span class="ansi-green-fg">█</span>█▇█▇▇▇██▇▇▅▇▅▅▅█▇▇▇▆▇▆▆▆▆▆▆▇▇▆▆▅▆▆▅▄▆▆▆▅▄▅▅▄▅▄▅▆▅▅▄▅▅▄ █
  78.1 μs<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>       179 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>The <a href="https://docs.julialang.org/en/v1/base/arrays/#Base.@views"><code>@views</code></a> macro can be useful in <a href="https://discourse.julialang.org/t/why-is-a-manual-in-place-addition-so-much-faster-than-and-on-range-indexed-arrays/3302">some operations</a>.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1"></a><span class="pp">@benchmark</span> <span class="pp">@views</span> <span class="fu">sum</span>(<span class="op">$</span>A[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">500</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">72.597 μs</span> … <span class="ansi-magenta-fg"> 2.598 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">74.139 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">80.202 μs</span> ± <span class="ansi-green-fg">42.103 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  █<span class="ansi-blue-fg">▇</span>▄▂▁<span class="ansi-green-fg"> </span>      ▁                                               ▁
  █<span class="ansi-blue-fg">█</span>███<span class="ansi-green-fg">█</span>██▇█▇████▆▇▆▆▆▇█▇▆▇▇▆▇▆▆▆▆▅▆▇▇▆▆▅▅▅▆▅▆▆▆▅▅▅▅▅▅▃▄▃▅▆▄▅ █
  72.6 μs<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>       170 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section id="take-home-message" class="slide level2">
<h2>Take-home message</h2>
<blockquote>
<p><strong>Get familiar with (good implementations of) BLAS/LAPACK and use them as much as possible.</strong></p>
</blockquote>
<h3 id="reading">Reading</h3>
<ul>
<li><a href="https://scholarworks.uark.edu/mascsls/10/">The Road to Exascale and Legacy Software for Dense Linear Algebra</a> by Jack Dongarra. <a href="https://fulbright.uark.edu/departments/math/_resources/pdf/event-related/sls/sls2021-lecture-dongarra.pdf">Slides</a></li>
</ul>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="numalgintro_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="numalgintro_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="numalgintro_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="numalgintro_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>